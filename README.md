# OGAAS Starter

This project is a basic starter for creating templates for Ogaas. Ogaas, named after the inital of "OpenGraph As A Service", is an easy-to-use web service for generating beautiful og-images. As Ogaas uses headless chrome to render the images, there's basically no limits for what you can put inside the image. You can use stylish web fonts, add beatiful gradients, and maybe even generate a rador chart based on your product's spec.

Also `i18n` contents are supported out-of-the-box by using corresponding webfonts.

## Develop

Register on https://ogpanic.com to get the API endpoint and API token.

Clone this repo and run the following command to start developing your own template.

```bash
# npx ogaas develop --help, for more infomation
$ npm run develop
```

Navigate to `http://localhost:3000/editor` to preview your og-image

### Source code structure

Templates sources are under `./src` and each of them in different directories. The directory name will be used as the template's name for rendering the og-image.

e.g. The name of template under `./src/blog` will be `blog`, and image generated by this template can be accessed via `https://<ogaas_endpoint>/og/blog/<id>.<jpeg|png>`.

Under `./src/<template_name>`, there will be 3 required files: `index.html`, `index.js`, `data.json`. And you can add image and stylesheets and other resources if required. Ogaas uses [parcel](https://github.com/parcel-bundler/parcel) for packaging the templates.

You can create multiple templates under `./src` and deploy all of them using `npm run deploy`.


### data.json

Ogaas allow you the specify only the id (slug) to access the generated og-image. Only who have uploaded the meta data of that id can determine what data to be shown in the image. `data.json` is the file to hold your mockup data when designing the template.

`id` will be used as the slug for the image and in `data`, you can put whatever you need for generating the final image.

```json
{"id": "first-blog", "data": {"name": "A great blog"}}
```

In a production environment, you normally would like to upload the data when the page is created or updated. In `oggas-cli`, there is an [API](#api) and a [command line tool](#command-line) for uploading data to ogass's server.

### index.html

This is the template html `ogaas` used to generate your og-image.

In the `head` section, there will be:

```html
<!-- Use whatever web font you like -->
<link href="https://fonts.googleapis.com/css?family=Montserrat:200,700&display=swap" rel="stylesheet" />
<!-- You can use inline <style> tag or preprocessors like LESS, SCSS -->
<link href="./style.css" rel="stylesheet" />
<!-- Inject the data for templates -->
<script src="./index.js"></script>
```

### index.js

Ogaas can automatically fill data to the template. If that's all you need to do with the template, just put this line in `index.js`

```javascript
import "ogaas-cli/src/utils";
```

For example, if you have the following data and markup in your html:

```html
<!-- {"id": "first-blog", "data": {"name": "A great blog"}} -->
<h1 data-o-text="name">Your blog title</h1>
```
Ogaas will use `name` as the field name to search in the `data`, and the following will be renderred on page.

```html
<h1 data-o-text="name">A great blog</h1>
```

Currently there are three custom types supported: `data-o-text`, `data-o-src` and `data-o-bg`.

- text - Update the `innerHTML` attribute of the DOM element.
- src - Update the `src` attribute.
- bg - Update the `style.backgroundImage` attribute.

ðŸ¥°Emoji is also supported for `text`. Emojis will be replace by corresponding images thanks to Twitter's [twemoji](https://twemoji.twitter.com/) (check the demo).

If you want to do something more, you can always use the following API to get the data.

```javascript
import { onUpdate } from "ogaas-cli/src/utils";

onUpdate(console.log)
// {name: 'A great blog'}
```

## Upload data

### API

Use the following code to upload the data. Service endpoint and api token are needed. You can either define `OGAAS_ENDPOINT`, `OGAAS_TOKEN` as environment variables or put then in the `.env` file.

```javascript
import { uploadMeta } from 'ogaas-cli'

await uploadMeta([
    {id: "my-first-blog", data: {"name": "A awesome blog title"}}
])
```

### Command line

Before running the command, `OGAAS_ENDPOINT`, `OGAAS_TOKEN` shall be defined.

```bash
# npx ogaas upload --help, for more infomation
$ npx ogaas upload <data.json>
```

## Build & Deploy

Build the templates.

```bash
# npx ogaas build --help, for more infomation
$ npm run build
```

Upload the built templates. Run `npm run build` before using this command.

note: Make sure you have the `.env.production` and correct API endpoint/token setup.

```bash
# npx ogaas deploy --help, for more infomation
$ npm run deploy
```
